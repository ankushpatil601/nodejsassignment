pipeline{

agent any 

tools {nodejs "node"}

stages{
       stage("Cloning Repository"){
              steps{
                     cleanWs()
                  git 'https://github.com/ankushpatil601/nodejsassignment.git'
              }
      }
      stage("Install Dependencies"){
            steps{
              sh 'npm install'
            }
      }
      stage("Testing"){
            steps{
              sh 'npm test'
              
            }
        }      
       stage("creating build"){
              steps{
                 sh 'tar -cvzf nodejsapp-$BUILD_NUMBER.tar.gz .'
              }
              
        }
        
        stage("Uploading to s3"){
              step([
                      $class: 'S3BucketPublisher',
                      entries: [[
                          sourceFile: '*.tar.gz',
                          bucket: 'frontendbkt',
                          selectedRegion: 'ap-south-1',
                          noUploadOnFailure: true,
                          managedArtifacts: true,
                          flatten: true,
                          showDirectlyInBrowser: true,
                          keepForever: true,
                      ]],
                      profileName: 's3-artifact',
                      dontWaitForConcurrentBuildCompletion: false, 
                  ])
        }
      
}

}
