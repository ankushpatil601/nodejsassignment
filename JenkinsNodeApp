@Library('github.com/releaseworks/jenkinslib') _

pipeline{

agent any 

tools {nodejs "node"}

stages{
       stage("Cloning Repository"){
              steps{
                     cleanWs()
                  git 'https://github.com/ankushpatil601/nodejsassignment.git'
              }
      }
      stage("Install Dependencies"){
            steps{
              sh 'npm install'
            }
      }
      stage("Testing"){
            steps{
              sh 'npm test'
              
            }
        }      
       stage("creating build"){
              steps{
                 sh 'tar -cvzf nodejsapp-$BUILD_NUMBER.tar.gz .'
              }
              
        }
        
        stage("uploading to s3"){
               steps{
                            withAwsCli( 
                                     credentialsId: 'aws-key', 
                                     defaultRegion: 'ap-south-1']) { 

                                    sh ''' 
                                       # COPY CREATED WAR FILE TO AWS S3
                                       # aws s3 cp target/petclinic.war s3://cloudbees-aws-demo/petclinic.war
                                       aws s3 ls
                                    '''
                                   }
               }
        
        }
        
        
      
}

}
